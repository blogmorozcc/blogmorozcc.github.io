+++
title = "Як встановити та налаштувати ZSH у Linux"
date = "2023-11-26"
tags = [
    "Linux",
    "Shell",
    "ZSH",
    "Oh My Zsh",
    "Powerlevel10k",
]
categories = [
    "Linux",
]
image = "header.jpg"
+++

## Введення

[Zsh](https://www.zsh.org/), або Z Shell, — це потужна та багатофункціональна оболонка командного рядка для Unix-подібних операційних систем, включаючи Linux і BSD (Berkeley Software Distribution). Це розширена версія Bourne Shell (sh) з численними вдосконаленнями та додатковими функціями. Zsh має на меті забезпечити більш інтерактивний і зручний досвід для користувачів оболонки.

Ось кілька причин, чому Zsh часто вважають однією з найкращих оболонок для систем Unix/Linux/BSD:

- **Редагування командного рядка**: Zsh пропонує розширені можливості редагування командного рядка, що дозволяє користувачам легко переходити та редагувати команди. Він підтримує такі функції, як розширення історії, виправлення орфографії та вдосконалене зіставлення шаблонів.

- **Налаштування**: Zsh можна налаштувати. Користувачі можуть налаштовувати різні аспекти поведінки оболонки, такі як швидкий вигляд, прив’язки клавіш і параметри завершення. Великі параметри конфігурації дозволяють адаптувати його до індивідуальних уподобань і робочих процесів.

- **Автодоповлення команд**: Zsh забезпечує Автодоповлення команд з урахуванням контексту, полегшуючи навігацію файловою системою та завершуючи імена та аргументи команд. Він може завершувати не лише команди, але й шляхи до файлів, змінні тощо.

- **Плагіни та розширення**: Zsh підтримує плагіни та розширення, які покращують його функціональність. Такі інструменти, як Oh-My-Zsh і Prezto, є популярними фреймворками, які спрощують керування конфігураціями Zsh і додають додаткові функції за допомогою плагінів.

- **Виправлення орфографії**: Zsh має вбудовану функцію виправлення орфографії, яка допомагає користувачам уникати помилок. Якщо ви неправильно введете команду або шлях до файлу, Zsh може запропонувати виправлення.

- **Інтерактивні функції**: Zsh містить інтерактивні функції, які покращують загальну взаємодію з користувачем, наприклад можливість легко переглядати історію команд, здійснювати пошук серед попередніх команд і повторно використовувати або ефективно змінювати команди.

- **Сумісність із оболонкою Bourne**: Zsh сумісний із синтаксисом оболонки Bourne (sh), що робить його відповідною заміною для sh або Bash. Існуючі сценарії оболонки, швидше за все, працюватимуть у Zsh без змін.

Хоча Zsh пропонує багатий набір функцій, вибір «найкращої» оболонки часто залежить від індивідуальних уподобань і конкретних випадків використання. Інші популярні оболонки включають Bash (Bourne Again SHell) і Fish (Friendly Interactive SHell), кожна з яких має свої сильні сторони та характеристики. Зрештою, найкраща оболонка — це та, яка узгоджується з вашим робочим процесом і відповідає вашим конкретним вимогам.

## Встановлення

### Встановіть пакет ZSH

Щоб установити пакет ZSH у вашій системі Linux, розгляньте можливість використання менеджера пакунків, який постачається з вашим дистрибутивом. Це робиться по-різному залежно від вашого дистрибутива, наприклад:

Для Arch Linux:

{{< highlight shell "linenos=false" >}}
sudo pacman -S zsh
{{< / highlight >}}

Для Fedora, Red Hat:

{{< highlight shell "linenos=false" >}}
sudo dnf install zsh
{{< / highlight >}}

Для Debian, Ubuntu, Linux Mint, ElementaryOS:

{{< highlight shell "linenos=false" >}}
sudo apt install zsh
{{< / highlight >}}

У моєму випадку я встановлюю його для Arch Linux:

![Приклад встановлення ZSH на Arch Linux](install.png)

### Встановлення ZSH оболонкою за замовчуванням

Щоб зробити новий встановлений ZSH стандартним для вашого користувача, введіть команду нижче та введіть свій пароль користувача для підтвердження:

{{< highlight shell "linenos=false" >}}
chsh -s $(which zsh)
{{< / highlight >}}

![Встановлення ZSH оболонкою за замовчуванням](zsh-default.png)

Після цього рекомендується перезавантажити систему, при наступному перезавантаженні оболонка ZSH буде використана для вашого користувача. Щоб перезавантажити комп’ютер, ви можете скористатися командою `sudo reboot` або просто скористатися графічним інтерфейсом робочого середовища для виконання перезавантаження.

### Перше налаштування

Щойно ви відкриєте програму терміналу після перезавантаження, zsh запропонує вам створити файли конфігурації за замовчуванням. Для застосування конфігурації натисніть на клавіатурі «0».

![Початкова конфігурація оболонки ZSH](zsh-initial.png)

### Встановлення Oh My ZSH

[Oh My Zsh](https://github.com/ohmyzsh/ohmyzsh) — це платформа з відкритим вихідним кодом і менеджер конфігурації для [Zsh](https://www.zsh.org/), Z Shell. Він був створений, щоб полегшити користувачам керування конфігураціями Zsh і покращити роботу командного рядка. Oh-My-Zsh надає колекцію плагінів, тем і допоміжних функцій, які можна легко інтегрувати в Zsh, дозволяючи користувачам налаштовувати та розширювати функціональність свого середовища оболонки.

Найпростіший спосіб щоб інсталювати ZSH — скористатися сценарієм інсталяції зі [Oh My Zsh GitHub Repository](https://github.com/ohmyzsh/ohmyzsh). Можна виконати інсталяційний сценарій, завантаживши його, ось так:

{{< highlight shell "linenos=false" >}}
sh -c "$(wget https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh -O -)"
{{< / highlight >}}

Після завершення скрипта ви побачите встановлену оболонку [Oh My Zsh](https://github.com/ohmyzsh/ohmyzsh), як на знімку екрана нижче.

![Початкова конфігурація оболонки ZSH](oh-my-zsh-post-install.png)

### Налаштування теми Oh My ZSH

[Oh My Zsh](https://github.com/ohmyzsh/ohmyzsh) має багато попередньо встановлених тем, які знаходяться в папці `~/.oh-my-zsh/themes/`.

![Початкова конфігурація оболонки ZSH](oh-my-zsh-default-themes.png)

Ви можете змінити свій файл `.zshrc` і використовувати попередньо встановлену тему.

{{< highlight shell "linenos=false" >}}
nano .zshrc
{{< / highlight >}}

А щоб змінити тему на `agnoster`, наприклад, знайдіть параметр `ZSH_THEME` і змініть його так:

{{< highlight shell "linenos=false" >}}
ZSH_THEME="agnoster"
{{< / highlight >}}

### Встановлення сторонної теми Oh My ZSH

Особисто мені тема [Powerlevel10k](https://github.com/romkatv/powerlevel10k) найбільше подобається серед інших, тому в цьому прикладі я покажу, як її встановити.

#### Встановлення сумісного шрифта терміналу

Щоб тема могла правильно відображати деякі символи, ваш термінал має використовувати спеціальний сумісний фон Meslo LGS NF. Для цього ви можете виконати [інструкції зі сховища GitHub](https://github.com/romkatv/powerlevel10k/blob/master/font.md).

Найпростіший спосіб - завантажити 4 файли шрифтів:

- [MesloLGS NF Regular.ttf](./MesloLGS%20NF%20Regular.ttf)
- [MesloLGS NF Bold.ttf](./MesloLGS%20NF%20Bold.ttf)
- [MesloLGS NF Italic.ttf](./MesloLGS%20NF%20Italic.ttf)
- [MesloLGS NF Bold Italic.ttf](./MesloLGS%20NF%20Bold%20Italic.ttf)

Щоб зробити їх доступними для всієї системи, перемістіть ці 4 файли до папки `/usr/share/fonts`:

```bash
sudo mv "MesloLGS NF Regular.ttf" /usr/share/fonts
sudo mv "MesloLGS NF Bold.ttf" /usr/share/fonts
sudo mv "MesloLGS NF Italic.ttf" /usr/share/fonts
sudo mv "MesloLGS NF Bold Italic.ttf" /usr/share/fonts
```

Щоб очистити кеш шрифтів, виконайте команду:

{{< highlight shell "linenos=false" >}}
sudo fc-cache
{{< / highlight >}}

Останнім кроком є зміна шрифту вашого терміналу. Це може залежати від терміналу, який ви використовуєте, але зазвичай ви можете просто змінити його в графічних налаштуваннях терміналу. У моєму випадку я налаштував його на використання `Meslo LGS NF Regular 12`.

![Приклад налаштувань шрифту терміналу](terminal-font-settings.png)

#### Встановлення теми Powerlevel10k

Спочатку завантажте тему [Powerlevel10k](https://github.com/romkatv/powerlevel10k) у свій каталог користувальницьких тем, це можна легко зробити за допомогою однієї команди:

{{< highlight shell "linenos=false" >}}
git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k
{{< / highlight >}}

![Процес клонування файлів репозиторію Powerlevel10k](powerlevel10k-clone.png)

Потім змініть файл `.zshrc`:

{{< highlight shell "linenos=false" >}}
nano .zshrc
{{< / highlight >}}

і встановіть параметр `ZSH_THEME` рівним `powerlevel10k/powerlevel10k`:

{{< highlight shell "linenos=false" >}}
ZSH_THEME="powerlevel10k/powerlevel10k"
{{< / highlight >}}

![Зміна теми в .zshrc](zshrc-theme.png)

Після збереження файлу скористайтеся наведеною нижче командою, щоб застосувати зміни:

{{< highlight shell "linenos=false" >}}
source ~/.zshrc
{{< / highlight >}}

#### Перше налаштування Powerlevel10k

Під час першого запуску нового спеціального рівня Powerlevel10k запуститься майстер налаштування теми Powerlevel10k. Ви завжди можете знову запустити цей майстер, використовуючи команду терміналу `p10k configure`. Майстер має кілька кроків, просто натисніть відповідні клавіші на клавіатурі, щоб відповісти. Нижче я покажу, як конфігурація виглядає в моєму випадку.

##### 1. Переконайтеся, що кілька символів шрифту відображаються правильно.

![Символ ромба](powerlevel10k-wizard1.png)
![Символ замка](powerlevel10k-wizard2.png)
![Символ стрілки вгору](powerlevel10k-wizard3.png)
![Відповідність між символами](powerlevel10k-wizard4.png)

Я просто відповів «так» на ці запитання (натиснувши «y» на клавіатурі), тому що все, що стосується відтворення символів, відображалося правильно.

##### 2. Налаштуйте стиль теми

Усі параметри в цьому розділі дозволяють змінити дизайн теми відповідно до ваших особистих уподобань. Я покажу, які відповіді я ввів у майстер, якщо ви захочете відтворити точну поведінку теми з цього посібника.

Швидке налаштування стилю дозволить налаштувати основний вигляд і відчуття, тут я відповів «3».
![Стиль запиту](powerlevel10k-wizard5.png)

Набір символів є важливим параметром, і насправді Юнікод дозволяє відображати більше символів, тому я настійно рекомендую відповісти тут «1».
![Набір символів](powerlevel10k-wizard6.png)

Цей параметр дозволяє показувати або приховувати поточний час у терміналі. Я не бачу в цьому жодної практичної користі, тому відповів `n` тут.
![Поточний час](powerlevel10k-wizard7.png)

Наступні налаштування стосуються зовнішнього вигляду теми, ви можете вибрати те, що вам подобається особисто.

![Розділювач запитів](powerlevel10k-wizard8.png)
![Заголовки підказок](powerlevel10k-wizard9.png)
![Підказки](powerlevel10k-wizard10.png)
![Висота запиту](powerlevel10k-wizard11.png)
![Швидке підключення](powerlevel10k-wizard12.png)

![Рейм підказки](powerlevel10k-wizard13.png)
![Інтервал підказок](powerlevel10k-wizard14.png)
![Значки](powerlevel10k-wizard15.png)
![Підказка](powerlevel10k-wizard16.png)
![Минуща підказка](powerlevel10k-wizard17.png)


Функція instant prompt дозволяє скоротити час завантаження оболонки ZSH, тому я настійно рекомендую ввімкнути її, відповівши тут «1».
![Instant prompt](powerlevel10k-wizard18.png)

Останнім кроком є застосування змін до `.zshrc`, просто дайте тут відповідь `y`.
![Застосувати зміни](powerlevel10k-wizard19.png)

Якщо все налаштовано правильно, ви побачите нову тему оболонки.

![Встановлена тема p10k](powerlevel10k-installed.png)

### Увімкніть вбудовані плагіни Oh My ZSH

Zsh підтримує плагіни та розширення, які покращують його функціональність. Oh-My-Zsh дозволяє легко керувати конфігураціями Zsh і додавати додаткові функції за допомогою плагінів.

Щоб переглянути список плагінів, які входять до складу Oh My ZSH, ви можете ввести команду:

{{< highlight shell "linenos=false" >}}
ls -a ~/.oh-my-zsh/plugins/
{{< / highlight >}}

У моєму випадку у мене є такі плагіни:

![Плагіни, включені до Oh My ZSH за замовчуванням](oh-my-zsh-bundled-plugins.png)

Потім ви можете змінити свій файл `.zshrc`:

{{< highlight shell "linenos=false" >}}
nano .zshrc
{{< / highlight >}}

і встановити параметр `plugins` для завантаження потрібних вам плагінів, у моєму випадку (як розробника Android) мені потрібні плагіни `git` і `adb`:

{{< highlight shell "linenos=false" >}}
plugins=(git adb)
{{< / highlight >}}

![Зміна плагінів у .zshrc](zshrc-plugins.png)

Потім застосуйте зміни до оболонки:

{{< highlight shell "linenos=false" >}}
source ~/.zshrc
{{< / highlight >}}

### Встановлення сторонніх плагінів

Також Oh My ZSH дозволяє встановлювати та використовувати сторонні плагіни. Наприклад, давайте встановимо плагіни `zsh-autosuggestions`, щоб мати хороші рекомендації щодо команд введення на основі історії.

Встановлення дуже схоже на встановлення спеціальної теми. Спочатку клонуйте плагін у каталог настроюваних плагінів.

{{< highlight shell "linenos=false" >}}
git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
{{< / highlight >}}

![Клонування плагіна zsh-autosuggestions](zsh-autosuggestions-clone.png)

Тоді ви можете змінити свій файл `.zshrc` так само, як я показав у розділі статті вище, тому в результаті ви матимете:

{{< highlight shell "linenos=false" >}}
plugins=(git adb zsh-autosuggestions)
{{< / highlight >}}

Потім застосуйте зміни до оболонки:

{{< highlight shell "linenos=false" >}}
source ~/.zshrc
{{< / highlight >}}

Після цього спробуйте щось набрати, і ви побачите пропозицію. Наприклад, я ввів "neo", а плагін пропонує використовувати "neofetch":

![Тестування плагіна zsh-autosuggestions](zsh-autosuggestions-works.png)

### Увімкнення автоматичних оновлень

Oh-My-Zsh має вбудований механізм оновлення, який допомагає користувачам підтримувати інсталяцію в актуальному стані за допомогою останніх змін, удосконалень і виправлень помилок, внесених спільнотою. Він також надає можливість автоматичного оновлення, але за умовчанням його вимкнено.

Щоб налаштувати автоматичне оновлення, вам слід встановити цю директиву у файлі `.zshrc`:

{{< highlight shell "linenos=false" >}}
zstyle ':omz:update' mode auto
{{< / highlight >}}

## Висновки

Таким чином, ZSH є більш багатофункціональною оболонкою, яка може зробити вашу роботу ефективнішою, розширюючи функціональність оболонки за допомогою спеціальних плагінів, тому її можна вважати кращою альтернативою bash, яка є оболонкою за замовчуванням у будь-якому сучасному дистрибутиві Linux.
